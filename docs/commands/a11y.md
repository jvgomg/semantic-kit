# Accessibility

Show the browser's accessibility tree — the structure that screen readers and assistive technologies use to navigate your page.

---

## What it does

The `a11y` commands use Playwright to capture the real browser accessibility tree, showing roles, names, states, and hierarchy exactly as assistive technologies receive them.

---

## Usage

### Static HTML (JavaScript disabled)

```bash
# Show accessibility tree (no JavaScript)
semantic-kit a11y https://example.com

# Machine-readable output
semantic-kit a11y https://example.com --json

# Custom timeout
semantic-kit a11y https://example.com --timeout 10000
```

### Hydrated DOM (JavaScript enabled)

```bash
# Show accessibility tree (with JavaScript)
semantic-kit a11y:js https://example.com

# Machine-readable output
semantic-kit a11y:js https://example.com --json
```

### Compare static vs hydrated

```bash
# Full comparison
semantic-kit a11y:compare https://example.com

# Compact summary
semantic-kit a11y:compare https://example.com --compact

# Machine-readable output
semantic-kit a11y:compare https://example.com --json
```

---

## Options

| Option | Description |
|--------|-------------|
| `--json` | Machine-readable JSON output |
| `--timeout` | Browser timeout in milliseconds (default: 30000) |
| `--compact` | Compact diff summary (`a11y:compare` only) |

---

## Behavior

| What it does | Why | Research |
|--------------|-----|----------|
| Captures browser accessibility tree | Shows what AT actually receives | [[accessibility-tree]] |
| Uses Playwright's ARIA snapshot | Standard serialization format | [[accessibility-tree]] |
| Compares static vs hydrated | JS may add critical content | [[streaming-ssr]] |

---

## Output

### Accessibility tree output

Both `a11y` and `a11y:js` show the browser's ARIA snapshot:

```
┌─────────────────────────────────────────────────────────────
│ Accessibility Tree (Static)
│ https://example.com
├─────────────────────────────────────────────────────────────
│ Summary
│   Landmarks:   banner: 1, navigation: 2, main: 1, contentinfo: 1
│   Structure:   heading: 5, list: 3, listitem: 12, img: 4
│   Interactive: link: 23, button: 8, textbox: 2
├─────────────────────────────────────────────────────────────
│ Accessibility Tree (ARIA Snapshot)
│   - banner:
│     - link "Home":
│       - /url: /
│     - navigation "Main":
│       - list:
│         - listitem:
│           - link "Products":
│             - /url: /products
│   - main:
│     - heading "Welcome" [level=1]
│     - paragraph: Introduction text here...
│     - button "Get Started"
│   - contentinfo:
│     - paragraph: © 2024 Example Inc.
└─────────────────────────────────────────────────────────────
```

### ARIA snapshot format

| Element | Meaning |
|---------|---------|
| `- role "name"` | Element with accessible name |
| `[level=1]` | ARIA attribute (heading level) |
| `[checked]` | Boolean state attribute |
| `/url: ...` | Link destination |
| Indentation | Parent-child relationships |

---

## Static vs Hydrated

| Command | What it shows | Use case |
|---------|---------------|----------|
| `a11y` | Static HTML accessibility tree | What AI crawlers/non-JS clients see |
| `a11y:js` | Hydrated DOM accessibility tree | What browsers/screen readers see |
| `a11y:compare` | Differences between static and hydrated | Identify JS-dependent accessibility content |

The `a11y:js` command uses Playwright to execute JavaScript and capture the accessibility tree after hydration. This reveals content that screen readers and browsers see but that static-HTML-only clients (like AI crawlers) miss.

The `a11y:compare` command runs both static and hydrated analysis, then highlights what JavaScript changes. Large differences indicate accessibility content that depends on JavaScript execution.

---

## Comparison output

The `a11y:compare` command shows what JavaScript changes:

```
┌─────────────────────────────────────────────────────────────
│ Accessibility Comparison
│ https://example.com
├─────────────────────────────────────────────────────────────
│ Role Changes
│   link: 23 → 47 (+24)
│   button: 8 → 15 (+7)
│   heading: 5 → 8 (+3)
├─────────────────────────────────────────────────────────────
│ Added by JavaScript
│   + - navigation "User Menu":
│   + - button "Settings"
│   + - heading "Dynamic Content" [level=2]
│   ... and 18 more
└─────────────────────────────────────────────────────────────
```

---

## Common problems

### JavaScript-dependent content

```
│ Role Changes
│   heading: 0 → 8 (+8)
│   link: 2 → 47 (+45)
```

**Problem:** Most accessibility content only exists after JavaScript runs.

**Solution:** Use server-side rendering. See [[streaming-ssr]].

### Missing landmarks

```
│ Summary
│   Structure:   heading: 5
│   Interactive: link: 23
```

**Problem:** No landmarks for screen reader navigation.

**Solution:** Use semantic HTML: `<header>`, `<nav>`, `<main>`, `<footer>`.

### Missing accessible names

```
│   - button
│   - link:
│       - /url: /profile
```

**Problem:** Screen readers announce "button" or "link" with no context.

**Solution:** Add text content, `aria-label`, or for images, `alt` text. See [[accessibility-tree]].

---

## JSON output

```json
{
  "url": "https://example.com",
  "ariaSnapshot": "- banner:\n  - link \"Home\":\n...",
  "counts": {
    "banner": 1,
    "navigation": 2,
    "main": 1,
    "link": 23,
    "button": 8
  }
}
```

For comparisons:

```json
{
  "url": "https://example.com",
  "static": { "ariaSnapshot": "...", "counts": {...} },
  "hydrated": { "ariaSnapshot": "...", "counts": {...} },
  "diff": {
    "roleChanges": { "link": [23, 47], "button": [8, 15] },
    "addedLines": ["+ - navigation \"User Menu\":", "..."],
    "removedLines": []
  }
}
```

---

## Requirements

All `a11y` commands require Playwright:

```bash
bun add playwright
bunx playwright install chromium
```

Playwright is an optional peer dependency — only needed for browser-based commands.

---

## Related

- [[accessibility-tree]] — How browsers build the accessibility tree
- [[axe-core]] — WCAG violation detection
- [[violation-detection-tools]] — Overview of accessibility testing tools
- [[streaming-ssr]] — JavaScript rendering and accessibility
